<!DOCTYPE html>
<html lang="th">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #F3F4F6; }
        .tab-active { border-bottom: 2px solid #3B82F6; color: #3B82F6; font-weight: 600; }
        .hidden-section { display: none; }
    </style>
    <link rel="icon" href="logo.png">

</head>
<body class="bg-gray-50 text-gray-800 min-h-screen relative pb-16">

    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-md mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-700"><strong>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong></h1>
            <div id="user-display" class="text-xs text-gray-400">By ‡∏Å‡∏∏‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á.</div>
        </div>
        <nav class="flex justify-around bg-white border-t border-gray-100">
            <button onclick="switchTab('form')" id="btn-form" class="flex-1 py-3 text-sm text-gray-500 tab-active">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button onclick="switchTab('history')" id="btn-history" class="flex-1 py-3 text-sm text-gray-500">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
            <button onclick="switchTab('leaderboard')" id="btn-leaderboard" class="flex-1 py-3 text-sm text-gray-500">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</button>
        </nav>
    </header>

    <main class="max-w-md mx-auto p-4">
        
        <section id="sec-form" class="space-y-4">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">‡πÉ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <form id="scoreForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label>
                        <input type="text" id="name" required class="w-full p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    </div>
                    
                    <div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                            <input type="text" id="role" required class="w-full p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
                        <input type="number" id="score" required class="w-full p-2.5 rounded-lg border border-gray-300 focus:border-blue-400 outline-none" placeholder="0">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                        <input type="date" id="date" required class="w-full p-2.5 rounded-lg border border-gray-300 focus:border-blue-400 outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏ó‡∏∏‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
                        <input type="number" id="budget" required class="w-full p-2.5 rounded-lg border border-gray-300 focus:border-blue-400 outline-none" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
                    </div>

                    <button type="submit" id="submitBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-500/30 transition active:scale-95">
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </form>
            </div>
        </section>

        <section id="sec-history" class="hidden-section space-y-3">
            <h2 class="text-lg font-semibold text-gray-700 pl-1">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
            <div id="history-list" class="space-y-3">
                <div class="text-center text-gray-400 py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>
        </section>

        <section id="sec-leaderboard" class="hidden-section">
            <h2 class="text-lg font-semibold text-gray-700 mb-3 pl-1">üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h2>
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-gray-500 text-sm">
                        <tr>
                            <th class="px-4 py-3">#</th>
                            <th class="px-4 py-3">‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="px-4 py-3 text-right">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-list" class="divide-y divide-gray-100 text-sm">
                        </tbody>
                </table>
            </div>
        </section>

    </main>

    <button onclick="toggleModal()" class="fixed bottom-4 right-4 bg-white text-gray-500 p-3 rounded-full shadow-lg border border-gray-200 hover:bg-gray-50 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    </button>

    <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl transform transition-all">
            <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á</h3>
            <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside mb-6">
                <li>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏û‡∏•‡∏Å‡∏≤‡∏£</li>
                <li>‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</li>
                <li>‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</li>
            </ul>
            <button onclick="toggleModal()" class="w-full bg-gray-100 text-gray-700 font-semibold py-2 rounded-lg hover:bg-gray-200">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

    <script>
        // *** ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_mW8OmNbuRgjettu_wrnnfXS3cP5IiJBuc9qYX2OCgH4RFyss4UwpInYJav8vP400Pg/exec"; 
        
        
        let currentUserId = "GUEST_USER"; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE

        // 1. Initialize LIFF (Optional but recommended for Real Production)
        async function main() {
            try {
                // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ User ID ‡∏à‡∏£‡∏¥‡∏á‡πÜ
                // await liff.init({ liffId: "YOUR_LIFF_ID" }); 
                // if (liff.isLoggedIn()) {
                //     const profile = await liff.getProfile();
                //     currentUserId = profile.userId;
                //     document.getElementById('user-display').innerText = profile.displayName;
                // }
            } catch (err) {
                console.error(err);
            }
        }
        main();

        // 2. Tab Switching Logic
        function switchTab(tabName) {
            ['form', 'history', 'leaderboard'].forEach(t => {
                document.getElementById(`sec-${t}`).classList.add('hidden-section');
                document.getElementById(`btn-${t}`).classList.remove('tab-active');
            });
            document.getElementById(`sec-${tabName}`).classList.remove('hidden-section');
            document.getElementById(`btn-${tabName}`).classList.add('tab-active');

            // Load data when tab is clicked
            if (tabName === 'history') loadHistory();
            if (tabName === 'leaderboard') loadLeaderboard();
        }

        // 3. Form Submission
        document.getElementById('scoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const originalBtnText = btn.innerText; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
            btn.disabled = true;

            const formData = {
                userId: currentUserId,
                name: document.getElementById('name').value,
                role: document.getElementById('role').value,
                score: document.getElementById('score').value,
                date: document.getElementById('date').value,
                budget: document.getElementById('budget').value
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(formData)
            })
            .then(() => {
                // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
                saveHistoryToLocal(formData);
                // ---------------------------------------

                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                document.getElementById('scoreForm').reset();
                btn.innerText = originalBtnText;
                btn.disabled = false;
                
                // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ history ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                if(!document.getElementById('sec-history').classList.contains('hidden-section')){
                    loadHistory();
                }
            })
            .catch(err => {
                console.error(err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß");
                btn.disabled = false;
            });
        });

        // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô tag script ‡∏õ‡∏¥‡∏î) ---
        function saveHistoryToLocal(data) {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡∏ß‡πà‡∏≤‡∏á)
            let history = JSON.parse(localStorage.getItem('myScoreHistory') || '[]');
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å (unshift)
            history.unshift({
                date: data.date,
                score: data.score,
                role: data.role
            });
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            localStorage.setItem('myScoreHistory', JSON.stringify(history));
        }

        // 4. Load History
        // 4. Load History (‡∏â‡∏ö‡∏±‡∏ö LocalStorage)
        function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = "";

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
            const data = JSON.parse(localStorage.getItem('myScoreHistory') || '[]');

            if(data.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 mt-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>';
                return;
            }

            data.forEach(item => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-400 flex justify-between items-center";
                div.innerHTML = `
                    <div>
                        <div class="text-sm text-gray-400">${item.date}</div>
                        <div class="font-medium text-gray-700">${item.role}</div>
                    </div>
                    <div class="text-xl font-bold text-blue-600">+${item.score}</div>
                `;
                list.appendChild(div);
            });
        }

        // 5. Load Leaderboard
        function loadLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '<tr><td colspan="3" class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';

            fetch(`${SCRIPT_URL}?action=leaderboard`)
            .then(res => res.json())
            .then(data => {
                list.innerHTML = "";
                data.forEach((item, index) => {
                    const rankClass = index === 0 ? "text-yellow-500 font-bold" : (index === 1 ? "text-gray-500 font-bold" : (index === 2 ? "text-orange-600 font-bold" : "text-gray-600"));
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3 ${rankClass}">${index + 1}</td>
                        <td class="px-4 py-3 font-medium text-gray-700">${item.name} <span class="text-xs text-gray-400 ml-1">(${item.role})</span></td>
                        <td class="px-4 py-3 text-right font-bold text-gray-800">${item.score}</td>
                    `;
                    list.appendChild(row);
                });
            });
        }

        // 6. Modal Toggle
        function toggleModal() {
            const modal = document.getElementById('infoModal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }
    </script>
</body>
</html>